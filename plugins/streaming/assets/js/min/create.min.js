!function(e){"use strict";app.viewModels.titles.create.map=function(){e.each(vars.title,function(l,a){"writer"==l||"director"==l?e.each(a,function(e,a){app.models.title[l+"s"].push(a.name)}):"image"==l||"link"==l?app.models.title[l+"s"]=ko.observableArray(a):"actor"==l?app.models.title.actors=ko.observableArray(e.map(a,function(e){return{id:e.id,name:e.name,image:e.image,char_name:e.pivot.char_name}})):"season"==l?app.models.title.seasons(a):(app.models.title[l]=a,e("#"+l).val(a))})},app.viewModels.titles.create.addLink=function(){var l=app.models.link;l.url().indexOf("iframe")>-1&&app.models.link.url(l.url().match(/src="([^"]+)"/)[1]),app.models.link.title_id=app.models.title.id||vars.titleId,app.utils.ajax({url:vars.urls.baseUrl+"/links/attach",data:ko.toJSON(app.models.link),success:function(l){app.models.link.id?e.each(app.models.title.links(),function(e,l){return l&&l.id==app.models.link.id?(app.models.title.links.remove(l),!1):void 0}):app.models.link.id=l.id,parseInt(l.approved)||(app.utils.noty(vars.trans.userLinkAdded,"success"),e("#add-link-modal").modal("hide")),app.models.title.links.push(ko.toJS(app.models.link)),app.models.link.url(""),app.models.link.label(""),app.models.link.id=null},error:function(e){app.utils.noty(e.responseJSON,"error")}})},app.viewModels.titles.create.editLink=function(e){app.models.link.url(e.url),app.models.link.type(e.type),app.models.link.label(e.label),app.models.link.season(e.season),app.models.link.episode(e.episode),app.models.link.id=e.id,window.scrollTo(0,0)},app.viewModels.titles.create.removeLink=function(l){e.each(app.models.title.links(),function(e,a){a&&a.url==l.url&&app.models.title.links.remove(a)}),(vars.title||vars.titleId)&&app.utils.ajax({url:vars.urls.baseUrl+"/links/detach",data:ko.toJSON({_token:vars.token,title_id:app.models.title.id||vars.titleId,url:l.url})})},app.models.title={actors:ko.observableArray().extend({rateLimit:50}),images:ko.observableArray([]).extend({rateLimit:50}),directors:ko.observableArray(),writers:ko.observableArray(),seasons:ko.observableArray(),links:ko.observableArray()},app.models.link={label:ko.observable(),url:ko.observable(),type:ko.observable(),_token:vars.token,reports:0,season:ko.observable(),episode:ko.observable()}}(jQuery);